# Lychee link checker configuration
# Documentation: https://lychee.cli.rs/usage/config/
#
# Usage:
#   - CI: Runs automatically on push/PR and weekly via GitHub Actions
#   - Local: Run `npm run check:links` to check links before committing
#
# The CI workflow checks external links only. For internal link checking,
# see the internal-link-check workflow.

# Timeout for each request (in seconds)
timeout = 30

# Maximum number of retries per link
max_retries = 3

# Maximum number of concurrent network requests
max_concurrency = 8

# Accept status codes:
# - 1xx: Informational responses
# - 2xx: Success responses
# - 3xx: Redirects (we follow them, but accept if max redirects hit)
# - 429: Rate limited - the link exists but we're being throttled.
#        This prevents false positives from aggressive rate limiting.
accept = [100, 101, 102, 103, 200, 201, 202, 203, 204, 205, 206, 207, 208, 226, 300, 301, 302, 303, 304, 307, 308, 429]

# Exclude private IP addresses and localhost
exclude_all_private = true

# Exclude mail addresses from checking
exclude_mail = true

# Exclude specific patterns
exclude = [
    # Localhost and local network
    'http://localhost*',
    'http://127.0.0.1*',
    'http://0.0.0.0*',

    # Requires authentication (badges, private repos)
    'https://sonarcloud.io/api/*',

    # Known flaky services (optional - add if needed)
    # 'https://twitter.com/*',
]

# Exclude these directories from being scanned
exclude_path = [
    'node_modules/',
    'cloudflare-worker/node_modules/',
    'playwright-report/',
    'test-results/',
    '.git/',
]

# User agent - identifies requests as coming from this project's CI
user_agent = "Merview-LinkChecker/1.0 (+https://github.com/mickdarling/merview)"

# Cache results to speed up repeated local runs
# Creates .lycheecache file (add to .gitignore if not already)
cache = true

# Include external links only
include_verbatim = false

# Follow redirects
max_redirects = 5

# Output file for results (used by CI workflow)
output = "lychee-report.md"
